# Phase 6ï¼šå€‹äººè¨˜å¸³ç³»çµ± + çŸ¥è­˜åº«å‚³æ‰¿ç³»çµ±

> æ—¥æœŸï¼š2026-01-26
> ç‹€æ…‹ï¼šğŸ”§ é€²è¡Œä¸­

---

## é–‹ç™¼é€²åº¦

### 2026-01-26 çŸ¥è­˜åº«è³‡æ–™æ›´æ–°

**Commit:** `0c81032` feat: add Notion knowledge base update script with hotel database

**æ–°å¢åŠŸèƒ½ï¼š**
1. å»ºç«‹ `scripts/update-notion-knowledge-base.mjs` æ‰¹æ¬¡æ›´æ–°è…³æœ¬
2. æ–°å»ºé£¯åº—è³‡æ–™åº«ï¼ˆNOTION_HOTEL_DBï¼‰

**è³‡æ–™æ–°å¢ï¼š**
| è³‡æ–™åº« | æ–°å¢ç­†æ•¸ | å…§å®¹ |
|--------|---------|------|
| é–€ç¥¨ | +8 | å¤§è±¡æ´»å‹• 3 ç­†ã€æ¸…èŠæ™¯é» 5 ç­† |
| é¤å»³ | +8 | å’–å•¡å»³ 8 ç­†ï¼ˆRistr8toã€Akha Ama ç­‰ï¼‰|
| é£¯åº— | +11 | æ¸…é‚ 7 ç­†ã€æ¸…èŠ 4 ç­†ï¼ˆç¾å¹³æ´²éš›ã€U Nimman ç­‰ï¼‰|

**ç›®å‰è³‡æ–™åº«ç¸½è¦½ï¼š**
- é¤å»³ï¼š28 ç­†ï¼ˆå«ç´ é£Ÿã€Mae Rimã€æ¹„ç™»ï¼‰
- å’–å•¡å»³ï¼š10 ç­†ï¼ˆç¨ç«‹è³‡æ–™åº«ï¼‰
- é–€ç¥¨ï¼š22 ç­†ï¼ˆ14 åŸæœ‰ + 8 æ–°å¢ï¼‰
- é£¯åº—ï¼š19 ç­†ï¼ˆæ¸…é‚ 11 + æ¸…èŠ 8ï¼‰
- æ™¯é»ï¼š8 ç­†ï¼ˆæ¸…èŠæ™¯é»ï¼‰
- è©±è¡“ï¼š0 ç­†ï¼ˆå¾…å¡«å……ï¼‰

**ç’°å¢ƒè®Šæ•¸æ›´æ–°ï¼š**
```env
NOTION_HOTEL_DB=2f437493-475d-8132-8c3b-dce5b0b832b7
```

### 2026-01-26 Google Maps é€£çµä¿®å¾©

**Commit:** `18361a5` fix: convert maps.app.goo.gl short URLs to full Google Maps URLs

**å•é¡Œï¼š**
- `maps.app.goo.gl` çŸ­é€£çµå‡ºç¾ "Dynamic Link Not Found" éŒ¯èª¤
- çŸ­é€£çµå¯èƒ½éæœŸæˆ–è¢« Google åœç”¨

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. å»ºç«‹ `scripts/fix-google-maps-urls.mjs` ä¿®å¾©è…³æœ¬
2. å°‡æ‰€æœ‰ `maps.app.goo.gl` è½‰æ›ç‚ºå®Œæ•´ Google Maps æœå°‹ URL

**ä¿®å¾©é …ç›®ï¼ˆ9 ç­†ï¼‰ï¼š**
| åº—å®¶åç¨± | æ–° URL æ ¼å¼ |
|----------|------------|
| HAAN Studio | `https://www.google.com/maps/search/HAAN+Studio+Chiang+Mai` |
| Versailles de Flore | `https://www.google.com/maps/search/Versailles+de+Flore+Chiang+Mai` |
| No.39 Cafe | `https://www.google.com/maps/search/No.39+Cafe+Chiang+Mai` |
| Ginger Farm Kitchen | `https://www.google.com/maps/search/Ginger+Farm+Kitchen+Chiang+Mai` |
| Monsoon Tea | å« Place ID æ ¼å¼ |
| Ristr8to Lab | `https://www.google.com/maps/search/Ristr8to+Lab+Nimmanhaemin+Chiang+Mai` |
| Doi Chaang Coffee | `https://www.google.com/maps/search/Doi+Chaang+Coffee+Chiang+Mai` |
| Akha Ama Coffee | å« Place ID æ ¼å¼ |
| æµ·é®®ç‡’çƒ¤369åƒåˆ°é£½ | `https://www.google.com/maps/search/369+Seafood+BBQ+Buffet+Chiang+Mai` |

**ç›¸é—œè…³æœ¬ï¼š**
- `scripts/fix-google-maps-urls.mjs` - ä¿®å¾© Google Maps çŸ­é€£çµ
- `scripts/fix-notion-urls.mjs` - ä¿®å¾© placeholder URL
- `scripts/validate-notion-urls.mjs` - é©—è­‰æ‰€æœ‰ URL

### 2026-01-26 çŸ¥è­˜åº«å¤§è¦æ¨¡æ“´å……

**Commit:** `0d5f0f5` feat: expand knowledge base with cafes, attractions, and regional data

**æ–°å»ºè³‡æ–™åº«ï¼š**
1. **å’–å•¡å»³æ¨è–¦** (`NOTION_CAFE_DB`) - å¾é¤å»³åˆ†é›¢ç¨ç«‹
2. **æ™¯é»æ¨è–¦** (`NOTION_ATTRACTION_DB`) - æ–°å»º

**æ–°å¢è³‡æ–™ï¼ˆ41 ç­†ï¼‰ï¼š**
| é¡åˆ¥ | ç­†æ•¸ | å…§å®¹ |
|------|------|------|
| ç´ é£Ÿé¤å»³ | 5 | Sukjai, Chada, Begin Vegan, Reform KafÃ©, Payod Shan |
| Mae Rim | 5 | Mai Heun 60, Kad Farang, Krua Lawng Khao, Gong Kham, Khong Khao |
| æ¹„ç™» | 5 | Khao Soy Mae Nai, Guay Tiew, Pang Pao, Air Diamond, Saiyut |
| å’–å•¡å»³ | 10 | HAAN, Versailles, Ristr8to, Akha Ama, Roast8ry ç­‰ |
| æ¸…é‚é£¯åº— | 4 | K Maison, Sensai, Burirattana, ANA Park |
| æ¸…èŠé£¯åº— | 4 | Riva Vista, Lavanda, Sann, Clay Bed |
| æ¸…èŠæ™¯é» | 8 | ç»ç’ƒå¯º, ç¿ å³°èŒ¶åœ’, Singha Park, çš‡å¤ªåè¡Œå®® ç­‰ |

**ç’°å¢ƒè®Šæ•¸æ–°å¢ï¼š**
```env
NOTION_CAFE_DB=2f437493-475d-8153-b3c9-fcd32601a82a
NOTION_ATTRACTION_DB=2f437493-475d-81f3-8cd3-eff452764b2c
```

---

## æ¦‚è¿°

Phase 6 èšç„¦æ–¼å…©å€‹æ ¸å¿ƒåŠŸèƒ½ï¼š
1. **å€‹äººè¨˜å¸³ç³»çµ±**ï¼šè¿½è¹¤æ³°åœ‹ç”Ÿæ´»æ”¯å‡ºã€æ¥­å‹™æˆæœ¬ï¼Œç¢ºä¿å©šç°½ 40 è¬é–€æª»
2. **çŸ¥è­˜åº«å‚³æ‰¿ç³»çµ±**ï¼šæ•´åˆæ•£è½è³‡æ–™ï¼Œç‚ºæœªä¾†å¥³å…’æ¥æ‰‹åšæº–å‚™

| Phase | æ€§è³ª | ç›®çš„ | ç‹€æ…‹ |
|-------|------|------|------|
| Phase 1 | å…¬é–‹ç¶²ç«™ | è½‰æ›ç‡å„ªåŒ– | âœ… å®Œæˆ |
| Phase 2 | SEO å„ªåŒ– | æµé‡ç²å– | âœ… å®Œæˆ |
| Phase 3 | å…§éƒ¨å·¥å…· | ç‡Ÿé‹æ•ˆç‡ | âœ… å®Œæˆ |
| Phase 4 | åŒ…è»Šå±•ç¤º | ç”¢å“é é¢ | âœ… å®Œæˆ |
| Phase 5 | ç¶²ç«™å„ªåŒ– | é«”é©—æå‡ | âœ… å®Œæˆ |
| **Phase 6** | **å€‹äººç³»çµ±** | **è²¡å‹™è¿½è¹¤ + å‚³æ‰¿** | ğŸ”§ é€²è¡Œä¸­ |

---

## 6.1 å€‹äººè¨˜å¸³ç³»çµ±

### éœ€æ±‚æ‘˜è¦

**ä½¿ç”¨æƒ…å¢ƒï¼š**
- æ¯ 1-2 é€±é–‹ä¸€æ¬¡ KBank ç¶²éŠ€
- æ‰‹å‹•è¼¸å…¥å…©å€‹æ—¥æœŸçš„å¸³æˆ¶é¤˜é¡
- è¨ˆç®—æœŸé–“æ”¯å‡ºï¼ˆå«æ¥­å‹™æˆæœ¬åˆ†é›¢ï¼‰
- å©šç°½è¦æ±‚å¸³æˆ¶è‡³å°‘ 40 è¬æ³°éŠ–

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
| åŠŸèƒ½ | èªªæ˜ |
|------|------|
| æ—¥æœŸå€é–“é¸æ“‡ | èµ·å§‹æ—¥ < çµæŸæ—¥ï¼Œ2025/01/01 èµ· |
| é¤˜é¡è¼¸å…¥ | å…©ç­†é¤˜é¡ï¼Œèµ·å§‹ â‰¥ çµæŸï¼ˆæ­£å¸¸æ”¯å‡ºæƒ…æ³ï¼‰|
| å…¥é‡‘è¨˜éŒ„ | æœŸé–“æœ‰è½‰å¸³å…¥é‡‘æ™‚è£œå……è¨˜éŒ„ |
| è‡ªå‹•è¨ˆç®— | ç¸½æ”¯å‡º = èµ·å§‹é¤˜é¡ + å…¥é‡‘ç¸½é¡ - çµæŸé¤˜é¡ |
| Notion æˆæœ¬ä¸²æ¥ | æ’ˆå–æœŸé–“çš„æ¥­å‹™æˆæœ¬ |
| ç”Ÿæ´»é–‹éŠ· | ç¸½æ”¯å‡º - æ¥­å‹™æˆæœ¬ = ç´”ç”Ÿæ´»é–‹éŠ· |
| 40 è¬è­¦ç¤º | é¤˜é¡æ¥è¿‘é–€æª»æ™‚æé†’ |

### é‚Šç•Œæ¢ä»¶

| è¦å‰‡ | é©—è­‰ |
|------|------|
| æ—¥æœŸ A < æ—¥æœŸ B | èµ·å§‹æ—¥ä¸èƒ½æ™šæ–¼çµæŸæ—¥ |
| æ—¥æœŸ â‰¤ ä»Šå¤© | ä¸èƒ½é¸æœªä¾†æ—¥æœŸ |
| æ—¥æœŸ â‰¥ 2025/01/01 | æœ€æ—©è¿½è¹¤æ—¥æœŸ |
| é¤˜é¡ â‰¥ 0 | ä¸èƒ½è¼¸å…¥è² æ•¸ |
| å…¥é‡‘æ—¥æœŸåœ¨å€é–“å…§ | å…¥é‡‘æ—¥æœŸå¿…é ˆåœ¨ A ~ B ä¹‹é–“ |

### å…¥é‡‘è¨˜éŒ„è¨­è¨ˆ

```
ç°¡åŒ–ç‰ˆæ¬„ä½ï¼š
â”œâ”€â”€ æ—¥æœŸ
â”œâ”€â”€ å°å¹£é‡‘é¡ï¼ˆå¾å°ç£åŒ¯å‡ºï¼‰
â”œâ”€â”€ æ³°éŠ–åˆ°å¸³ï¼ˆæœ€çµ‚é€² KBankï¼‰
â”œâ”€â”€ å¯¦éš›åŒ¯ç‡ï¼ˆè‡ªå‹•è¨ˆç®—ï¼šæ³°éŠ– Ã· å°å¹£ï¼‰
â””â”€â”€ å‚™è¨»ï¼ˆå¯é¸ï¼‰

ä¸è¿½è¹¤çš„ç´°ç¯€ï¼ˆç°¡åŒ–ï¼‰ï¼š
â”œâ”€â”€ USDT è²·å…¥åƒ¹
â”œâ”€â”€ USDT è³£å‡ºåƒ¹
â”œâ”€â”€ ä¸­é–“æ‰‹çºŒè²»æ˜ç´°
â””â”€â”€ å„å¹³å°è²»ç”¨
```

### UI è¨­è¨ˆ

```
è·¯å¾‘ï¼š/admin/accounting

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’° å€‹äººè¨˜å¸³                                    [ğŸ”’ å·²ç™»å…¥]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸ“… æœŸé–“è¨­å®š                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ èµ·å§‹æ—¥æœŸ    â”‚    â”‚ çµæŸæ—¥æœŸ    â”‚                         â”‚
â”‚  â”‚ 2025/12/18  â”‚ â†’  â”‚ 2026/01/25  â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                              â”‚
â”‚  ğŸ’³ å¸³æˆ¶é¤˜é¡                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ èµ·å§‹é¤˜é¡    â”‚    â”‚ çµæŸé¤˜é¡    â”‚                         â”‚
â”‚  â”‚ 745,668 à¸¿   â”‚    â”‚ 500,000 à¸¿   â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                              â”‚
â”‚  ğŸ’µ æœŸé–“å…¥é‡‘ï¼ˆé¸å¡«ï¼‰                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ æ—¥æœŸ     â”‚ å°å¹£       â”‚ æ³°éŠ–åˆ°å¸³   â”‚ åŒ¯ç‡     â”‚    â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ 01/10    â”‚ 350,000    â”‚ 346,511    â”‚ 0.99     â”‚ âœ•  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜     â”‚
â”‚  [+ æ–°å¢å…¥é‡‘]                                                â”‚
â”‚                                                              â”‚
â”‚  [è¨ˆç®—]                                                      â”‚
â”‚                                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                   â”‚
â”‚                                                              â”‚
â”‚  ğŸ“Š è¨ˆç®—çµæœ                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ æœŸé–“ç¸½æ”¯å‡º        â”‚  245,668 à¸¿          â”‚                â”‚
â”‚  â”‚ æ¥­å‹™æˆæœ¬(Notion)  â”‚   45,000 à¸¿          â”‚                â”‚
â”‚  â”‚ ç”Ÿæ´»é–‹éŠ·          â”‚  200,668 à¸¿          â”‚                â”‚
â”‚  â”‚ æ—¥å‡æ”¯å‡º          â”‚    6,307 à¸¿/å¤©       â”‚                â”‚
â”‚  â”‚ 40è¬é–€æª»ç‹€æ…‹      â”‚  âœ… å®‰å…¨ (é¤˜ 10è¬)  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€è¡“æ¶æ§‹

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â””â”€â”€ accounting/
â”‚   â”‚       â””â”€â”€ page.tsx           # è¨˜å¸³é é¢ï¼ˆéœ€ç™»å…¥ï¼‰
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ accounting/
â”‚           â””â”€â”€ route.ts           # APIï¼šNotion æˆæœ¬æŸ¥è©¢
â”œâ”€â”€ components/
â”‚   â””â”€â”€ accounting/
â”‚       â”œâ”€â”€ DateRangeSelector.tsx  # æ—¥æœŸé¸æ“‡å™¨
â”‚       â”œâ”€â”€ BalanceInput.tsx       # é¤˜é¡è¼¸å…¥
â”‚       â”œâ”€â”€ TransferRecords.tsx    # å…¥é‡‘è¨˜éŒ„è¡¨
â”‚       â”œâ”€â”€ CalculationResult.tsx  # è¨ˆç®—çµæœ
â”‚       â””â”€â”€ ThresholdWarning.tsx   # 40è¬è­¦ç¤º
â””â”€â”€ lib/
    â””â”€â”€ accounting/
        â”œâ”€â”€ calculator.ts          # è¨ˆç®—é‚è¼¯
        â””â”€â”€ types.ts               # å‹åˆ¥å®šç¾©
```

### API è¨­è¨ˆ

```typescript
// POST /api/accounting
// Request
{
  startDate: "2025-12-18",
  endDate: "2026-01-25"
}

// Response
{
  businessCost: 45000,           // å¾ Notion æ’ˆå–çš„æ¥­å‹™æˆæœ¬
  orders: [                      // æœŸé–“è¨‚å–®æ˜ç´°
    { name: "å®¢æˆ¶A", cost: 15000, date: "2025-12-20" },
    { name: "å®¢æˆ¶B", cost: 30000, date: "2026-01-05" }
  ],
  parseWarnings: [               // è§£æè­¦å‘Š
    { orderId: "xxx", message: "æˆæœ¬æ¬„ä½æœ‰ä¸ç¢ºå®šå€¼" }
  ]
}
```

---

## 6.2 æˆæœ¬æ–‡å­—è§£æå™¨

### å•é¡ŒèƒŒæ™¯

Notion çš„ã€Œç¸½æˆæœ¬ã€æ¬„ä½æ˜¯è‡ªç”±æ ¼å¼æ–‡å­—ï¼ŒåŒ…å«ï¼š
- ç®—å¼ï¼ˆ`2700*2 +4800`ï¼‰
- å‚™è¨»ï¼ˆ`(å·²ä»˜çµ¦å°é›²)`ï¼‰
- èª¿æ•´ï¼ˆ`ä»¥ä¸Šèª¿æ•´... å…±ï¼š24450`ï¼‰
- å¤šæ®µåŠ ç¸½ï¼ˆ`=24450+23680`ï¼‰
- ä¸ç¢ºå®šæè¿°ï¼ˆ`ä¸çŸ¥é“`ã€`special case`ï¼‰

### è§£æé‚è¼¯

```
è§£æå„ªå…ˆé †åºï¼š

1. æ‰¾æ˜ç¢ºç¸½è¨ˆï¼ˆæœ€é«˜å„ªå…ˆï¼‰
   â”œâ”€â”€ é—œéµå­—ï¼šã€Œå…±:ã€ã€Œtotal:ã€ã€Œæˆæœ¬ç¸½å…±:ã€
   â”œâ”€â”€ æœ€å¾Œä¸€è¡Œçš„ç¨ç«‹æ•¸å­—
   â””â”€â”€ æœ€å¾Œä¸€å€‹ã€Œ= æ•¸å­—ã€
   â†’ confident: true âœ…

2. è™•ç†ã€Œä»¥ä¸Šèª¿æ•´ã€
   â”œâ”€â”€ å¦‚æœæœ‰ã€Œä»¥ä¸Šèª¿æ•´ã€ã€Œèª¿æ•´å¾Œã€
   â””â”€â”€ ç”¨èª¿æ•´å¾Œçš„å€¼ï¼Œå¿½ç•¥èª¿æ•´å‰
   â†’ confident: true âœ…

3. å¤šæ®µç›¸åŠ 
   â”œâ”€â”€ æ ¼å¼ï¼šã€Œ=A+Bã€ã€Œ=A+B+Cã€
   â””â”€â”€ è¨ˆç®—ç¸½å’Œ
   â†’ confident: true âœ…

4. ç°¡å–®ç®—å¼è¨ˆç®—
   â”œâ”€â”€ æ²’æœ‰æ˜ç¢ºç¸½è¨ˆ
   â””â”€â”€ å˜—è©¦è§£æä¸¦è¨ˆç®—
   â†’ confident: false âš ï¸

5. ç„¡æ³•è§£æ
   â””â”€â”€ å›å‚³ 0ï¼Œæ¨™è¨˜éœ€äººå·¥ç¢ºèª
   â†’ confident: false âš ï¸

ç‰¹æ®Šæ¨™è¨˜ï¼š
â”œâ”€â”€ ã€Œä¸çŸ¥é“ã€ã€Œå¯èƒ½ã€ã€Œspecial caseã€â†’ âš ï¸ æœ‰å€¼ä½†æ¨™è¨˜
â”œâ”€â”€ ã€Œå®¢äººè‡ªä»˜ã€â†’ ä¸è¨ˆå…¥æˆæœ¬
â””â”€â”€ ã€Œåˆ°æ™‚ä»˜ã€â†’ æ¨™è¨˜ç‚ºå¾…ç¢ºèª
```

### æ¸¬è©¦æ¡ˆä¾‹

| è¼¸å…¥ | é æœŸè¼¸å‡º | confident |
|------|---------|-----------|
| `å…±: 20500\nå¤œé–“ï¼š650*17= 11050\n=20500+11050` | 31550 | âœ… |
| `å…±ï¼š25250\nä»¥ä¸Šèª¿æ•´å°éŠæ”¹1500\nå…±ï¼š24450` | 24450 | âœ… |
| `=24450+23680` | 48130 | âœ… |
| `ç®—19000\nä¸çŸ¥é“éƒ­å§æˆæœ¬...special case` | 19000 | âš ï¸ |
| `æ²’å¯«æ•¸å­—` | 0 | âš ï¸ |

### å¯¦ä½œæ–¹å¼

```
æ–¹æ¡ˆï¼šè¦å‰‡å¼è§£æ + LLM å‚™æ´

æµç¨‹ï¼š
1. æ­£å‰‡è¡¨é”å¼å˜—è©¦è§£æ
2. å¦‚æœè¦å‰‡å¼æœ‰ä¿¡å¿ƒå€¼ â†’ å›å‚³
3. å¦‚æœè¦å‰‡å¼ä¸ç¢ºå®š â†’ å‘¼å« Claude API è§£æ
4. å¦‚æœ LLM ä¹Ÿä¸ç¢ºå®š â†’ æ¨™è¨˜éœ€äººå·¥ç¢ºèª

Claude API ä½¿ç”¨ï¼š
â”œâ”€â”€ æ¨¡å‹ï¼šclaude-3-haikuï¼ˆä¾¿å®œå¿«é€Ÿï¼‰
â”œâ”€â”€ Promptï¼šã€Œè§£æä»¥ä¸‹æ–‡å­—ä¸­çš„æœ€çµ‚æˆæœ¬é‡‘é¡...ã€
â””â”€â”€ åªåœ¨è¦å‰‡å¼å¤±æ•—æ™‚å‘¼å«ï¼Œç¯€çœ API è²»ç”¨
```

### æŠ€è¡“æ¶æ§‹

```
src/lib/notion/
â”œâ”€â”€ profit-parser.ts           # ç¾æœ‰è§£æå™¨ï¼ˆåŸºç¤ç‰ˆï¼‰
â””â”€â”€ cost-parser/
    â”œâ”€â”€ index.ts               # ä¸»å…¥å£
    â”œâ”€â”€ rules.ts               # è¦å‰‡å¼è§£æ
    â”œâ”€â”€ llm-fallback.ts        # LLM å‚™æ´
    â””â”€â”€ types.ts               # å‹åˆ¥å®šç¾©

// å‹åˆ¥å®šç¾©
interface ParseResult {
  value: number;
  confident: boolean;
  warnings: string[];
  rawText: string;
}
```

---

## 6.3 çŸ¥è­˜åº«ç³»çµ±

### æ¶æ§‹è¨­è¨ˆ

```
æ–¹æ¡ˆï¼šNotion ç‚ºä¸»ï¼Œç¶²ç«™ç‚ºå…¥å£

Notionï¼ˆä¸»è¦ç·¨è¼¯å€ï¼‰           ç¶²ç«™å¾Œå°ï¼ˆå…¥å£ & å‘ˆç¾ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‚ é¤å»³è³‡æ–™åº«         â”€â”€APIâ”€â”€â†’  ğŸ” /admin/knowledge/restaurants
ğŸ“‚ é–€ç¥¨è³‡æ–™åº«         â”€â”€APIâ”€â”€â†’  ğŸ« /admin/knowledge/tickets
ğŸ“‚ è©±è¡“è³‡æ–™åº«         â”€â”€APIâ”€â”€â†’  ğŸ’¬ /admin/knowledge/replies

ğŸ“„ ç³»çµ±æ‰‹å†Š           â”€é€£çµâ”€â†’   ğŸ“– /admin/legacy/manual
ğŸ“„ çµ¦å¥³å…’çš„è©±         â”€é€£çµâ”€â†’   ğŸ’ /admin/legacy/letter
```

### Notion è³‡æ–™åº«çµæ§‹

#### é¤å»³è³‡æ–™åº«

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| åç¨± | Title | é¤å»³åç¨±ï¼ˆæ³°æ–‡ï¼‰ |
| åˆ†é¡ | Select | æ³°å¼ç†±ç‚’ã€æ³°å¼ç‡’çƒ¤ã€å°é™¶é‹ã€è„†çš®è±¬ã€æµ·é®®ã€å’–å•¡å»³ |
| åœ°åœ–é€£çµ | URL | Google Maps é€£çµ |
| å‚™è¨» | Text | ç‰¹è‰²èªªæ˜ |
| æ¨è–¦åº¦ | Select | â­â­â­â­â­ ~ â­â­â­ |
| åƒ¹ä½ | Select | ä¾¿å®œã€ä¸­ç­‰ã€åè²´ |
| æœ€å¾Œæ›´æ–° | Date | è³‡æ–™æ›´æ–°æ—¥æœŸ |

**åˆå§‹è³‡æ–™ï¼š**
```
1. à¸–à¸¹à¸ à¸­à¸´à¹ˆà¸¡ à¸­à¸£à¹ˆà¸­à¸¢ à¸‚à¹‰à¸²à¸§à¸•à¹‰à¸¡ 1 à¸šà¸²à¸— | æ³°å¼ç†±ç‚’ | 1à¸¿ç²¥
2. à¸«à¸¡à¸¹à¸à¸£à¸°à¸—à¸°à¸Šà¹‰à¸²à¸‡à¹€à¸œà¸·à¸­à¸ | æ³°å¼ç‡’çƒ¤
3. à¸«à¸¡à¸¹à¸ˆà¸¸à¹ˆà¸¡à¹€à¸ˆà¹‰à¹‚à¸ª | å°é™¶é‹
4. Neng's Clay Oven Roasted Pork | è„†çš®è±¬
5. æµ·é®®ç‡’çƒ¤369åƒåˆ°é£½
```

#### é–€ç¥¨è³‡æ–™åº«

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| æ™¯é» | Title | æ™¯é»åç¨± |
| æˆäººç¥¨åƒ¹ | Number | æ³°éŠ– |
| å…’ç«¥ç¥¨åƒ¹ | Number | æ³°éŠ– |
| å…’ç«¥å®šç¾© | Text | ä¾‹ï¼š101-140cmã€3-9æ­² |
| å…è²»æ¢ä»¶ | Text | ä¾‹ï¼š100cmä»¥ä¸‹ã€0-3æ­² |
| æˆ‘æ–¹æˆæœ¬ | Number | å¦‚æœæœ‰ä»£è¨‚æˆæœ¬ |
| å”®åƒ¹å«é¤ | Number | å°å®¢äººå ±åƒ¹ï¼ˆå«é¤ï¼‰ |
| åˆ©æ½¤ | Formula | å”®åƒ¹ - æˆæœ¬ |
| å‚™è¨» | Text | ç‰¹æ®Šèªªæ˜ |
| æœ€å¾Œæ›´æ–° | Date | åƒ¹æ ¼æ›´æ–°æ—¥æœŸ |

**åˆå§‹è³‡æ–™ï¼š**
```
1. å¤œé–“å‹•ç‰©åœ’ | æˆäºº1200 | å…’ç«¥600(101-140cm) | å…è²»<100cm
2. å¤§è±¡ä¿è­·ç‡Ÿ | æˆäºº1600 | å…’ç«¥800(3-9æ­²) | å…è²»0-3æ­² | æˆæœ¬600 | å”®åƒ¹1600
3. ATVè¶Šé‡è»Š 10km | é§•é§›2000 | å¾Œåº§800
4. ATVè¶Šé‡è»Š 20km | é§•é§›3000 | å¾Œåº§1300
5. ç™½æ²³æ¼‚æµ 7km | 1200/äºº
6. ç™½æ²³æ¼‚æµ 10km | 1800/äºº
7. å¤§è±¡ä¾¿ä¾¿é€ ç´™å…¬åœ’ | 150 | å…è²»0-3æ­²
8. æ¸…é‚å¤§å³½è°·æ°´ä¸Šæ¨‚åœ’ | æˆäºº950 | å…’ç«¥750(90-120cm) | å…è²»<90cm
9. 3Dåšç‰©é¤¨ | æˆäºº400 | å…’ç«¥240(100-140cm) | å…è²»<100cm
10. èŒµä»–å„‚åœ‹å®¶å…¬åœ’ | æˆäºº300 | å…’ç«¥150(3-14æ­²) | å…è²»0-3æ­²
11. è±¬è±¬è¾²å ´ | 200/äºº
12. Phoenix Adventure Park | å°ç«è»Š90 | 2æ­²ä»¥ä¸‹å…è²»
13. é•·é ¸æ‘ | 300/äºº
14. æ¸…é“ç«¹ä¼ | 500/è‰˜(2-3äºº)
```

#### è©±è¡“è³‡æ–™åº«

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| æƒ…å¢ƒ | Select | è©¢åƒ¹ã€å¤©æ°£ã€è¡Œç¨‹ç¢ºèªã€å”®å¾Œ... |
| æ¨™é¡Œ | Title | ç°¡çŸ­æè¿° |
| å›è¦†å…§å®¹ | Text | å®Œæ•´è©±è¡“ |
| å‚™è¨» | Text | ä½¿ç”¨æ™‚æ©Ÿèªªæ˜ |

### è¡Œç¨‹è¡¨é€£å‹•

```
Phase 3 è¡Œç¨‹è¡¨                    é–€ç¥¨è³‡æ–™åº«
â•â•â•â•â•â•â•â•â•â•â•â•â•â•                    â•â•â•â•â•â•â•â•â•â•

æ™¯é»ï¼š[å¤œé–“å‹•ç‰©åœ’ â–¼]  â”€â”€â”€â”€é—œè¯â”€â”€â”€â”€â†’  å¤œé–“å‹•ç‰©åœ’
                                     â”œâ”€â”€ æˆäººï¼š1200
å®¢æˆ¶äººæ•¸ï¼š                           â”œâ”€â”€ å…’ç«¥ï¼š600
æˆäºº 2 äºº                            â””â”€â”€ å…è²»ï¼š<100cm
å…’ç«¥ 1 äºº (120cm)
å¹¼å…’ 1 äºº (80cm)

è‡ªå‹•è¨ˆç®—ï¼š
â”œâ”€â”€ é–€ç¥¨é ä¼°ï¼š1200Ã—2 + 600Ã—1 + 0 = 3000 à¸¿
â”œâ”€â”€ æˆ‘æ–¹æˆæœ¬ï¼šï¼ˆå¦‚æœæœ‰ä»£è¨‚ï¼‰
â””â”€â”€ å»ºè­°å”®åƒ¹ï¼šï¼ˆå¦‚æœæœ‰è¨­å®šï¼‰
```

---

## 6.4 æ¬Šé™è¨­è¨ˆ

### å±¤ç´šå®šç¾©

| Level | è§’è‰² | è¨˜å¸³ç³»çµ± | çŸ¥è­˜åº« | Dashboard | æ©Ÿå¯†è³‡è¨Š |
|-------|------|---------|--------|-----------|---------|
| Owner | Eric | âœ… å®Œæ•´ | âœ… ç·¨è¼¯ | âœ… å®Œæ•´ | âœ… |
| Family | å¥³å…’ | âŒ | âœ… æŸ¥çœ‹ | âœ… å”¯è®€ | âš ï¸ åˆ†éšæ®µ |
| Collaborator | åˆä½œè€… | âŒ | âœ… å”¯è®€ | âš ï¸ çµ±è¨ˆ | âŒ |

### å¯¦ä½œæ–¹å¼

```typescript
// src/lib/auth/roles.ts

export const ROLES = {
  OWNER: 'owner',
  FAMILY: 'family',
  COLLABORATOR: 'collaborator',
} as const;

export const PERMISSIONS = {
  [ROLES.OWNER]: {
    accounting: true,
    knowledge: 'edit',
    dashboard: 'full',
    legacy: 'full',
  },
  [ROLES.FAMILY]: {
    accounting: false,
    knowledge: 'view',
    dashboard: 'readonly',
    legacy: 'partial',  // ä¸å«æ©Ÿå¯†
  },
  [ROLES.COLLABORATOR]: {
    accounting: false,
    knowledge: 'view',
    dashboard: 'stats',  // åªçœ‹çµ±è¨ˆ
    legacy: false,
  },
};

// Email å°æ‡‰è§’è‰²
export const EMAIL_ROLES: Record<string, Role> = {
  'eric19921204@gmail.com': ROLES.OWNER,
  // æœªä¾†ï¼šå¥³å…’çš„ email
  // æœªä¾†ï¼šåˆä½œè€…çš„ email
};
```

---

## 6.5 é–‹ç™¼è¨ˆåŠƒ

### é‡Œç¨‹ç¢‘

```
Week 1ï¼šè¨˜å¸³ç³»çµ± MVP
â”œâ”€â”€ Task 1.1ï¼šå»ºç«‹ /admin/accounting é é¢éª¨æ¶
â”œâ”€â”€ Task 1.2ï¼šæ—¥æœŸé¸æ“‡å™¨ + é¤˜é¡è¼¸å…¥å…ƒä»¶
â”œâ”€â”€ Task 1.3ï¼šå…¥é‡‘è¨˜éŒ„ CRUD
â”œâ”€â”€ Task 1.4ï¼šè¨ˆç®—é‚è¼¯ + çµæœé¡¯ç¤º
â””â”€â”€ Task 1.5ï¼š40 è¬é–€æª»è­¦ç¤º

Week 2ï¼šæˆæœ¬è§£æå™¨å¼·åŒ–
â”œâ”€â”€ Task 2.1ï¼šæˆæœ¬è§£æå™¨é‡æ§‹ï¼ˆè¦å‰‡å¼ï¼‰
â”œâ”€â”€ Task 2.2ï¼šLLM å‚™æ´æ•´åˆ
â”œâ”€â”€ Task 2.3ï¼šå–®å…ƒæ¸¬è©¦ï¼ˆè¦†è“‹æ‰€æœ‰ç¯„ä¾‹ï¼‰
â”œâ”€â”€ Task 2.4ï¼šDashboard æ•´åˆå„ªåŒ–
â””â”€â”€ Task 2.5ï¼šè§£æè­¦å‘Š UI

Week 3ï¼šNotion çŸ¥è­˜åº«
â”œâ”€â”€ Task 3.1ï¼šå»ºç«‹ Notion é¤å»³è³‡æ–™åº« + å¡«å…¥è³‡æ–™
â”œâ”€â”€ Task 3.2ï¼šå»ºç«‹ Notion é–€ç¥¨è³‡æ–™åº« + å¡«å…¥è³‡æ–™
â”œâ”€â”€ Task 3.3ï¼šå»ºç«‹ Notion è©±è¡“è³‡æ–™åº«
â”œâ”€â”€ Task 3.4ï¼šçŸ¥è­˜åº« API ç«¯é»
â””â”€â”€ Task 3.5ï¼š/admin/knowledge å…¥å£é é¢

Week 4ï¼šæ•´åˆ + å‚³æ‰¿
â”œâ”€â”€ Task 4.1ï¼šè¡Œç¨‹è¡¨æ™¯é»ä¸‹æ‹‰é€£å‹•é–€ç¥¨
â”œâ”€â”€ Task 4.2ï¼šé–€ç¥¨è‡ªå‹•è¨ˆç®—
â”œâ”€â”€ Task 4.3ï¼šå‚³æ‰¿å°ˆå€å…¥å£ï¼ˆé€£çµ Notionï¼‰
â”œâ”€â”€ Task 4.4ï¼šæ¬Šé™å±¤ç´šå¯¦ä½œ
â””â”€â”€ Task 4.5ï¼šæ¸¬è©¦é©—è­‰ + éƒ¨ç½²
```

### Git åˆ†æ”¯ç­–ç•¥

```
main
 â”‚
 â””â”€â”€ feature/phase6-accounting
      â”‚
      â”œâ”€â”€ phase6/accounting-page      # è¨˜å¸³é é¢
      â”œâ”€â”€ phase6/cost-parser          # æˆæœ¬è§£æå™¨
      â”œâ”€â”€ phase6/knowledge-api        # çŸ¥è­˜åº« API
      â””â”€â”€ phase6/itinerary-tickets    # è¡Œç¨‹è¡¨é€£å‹•

åˆä½µç­–ç•¥ï¼š
1. æ¯å€‹ Task å®Œæˆå¾Œ commit
2. æ¯å€‹ Week å®Œæˆå¾Œ PR â†’ feature/phase6-accounting
3. Phase 6 å…¨éƒ¨å®Œæˆå¾Œ PR â†’ main
```

### æ¸¬è©¦ç­–ç•¥

| å±¤ç´š | æ¶µè“‹ç¯„åœ | å·¥å…· |
|------|---------|------|
| å–®å…ƒæ¸¬è©¦ | æˆæœ¬è§£æå™¨ã€è¨ˆç®—é‚è¼¯ | Vitest |
| æ•´åˆæ¸¬è©¦ | Notion API ä¸²æ¥ | Vitest + MSW |
| E2E æ¸¬è©¦ | è¨˜å¸³æµç¨‹ã€çŸ¥è­˜åº«æŸ¥è©¢ | Playwright |

### é©—æ”¶æ¨™æº–

**è¨˜å¸³ç³»çµ±ï¼š**
- [ ] å¯é¸æ“‡æ—¥æœŸå€é–“ä¸¦è¼¸å…¥é¤˜é¡
- [ ] å¯æ–°å¢/åˆªé™¤å…¥é‡‘è¨˜éŒ„
- [ ] è¨ˆç®—çµæœæ­£ç¢ºï¼ˆå« Notion æˆæœ¬ï¼‰
- [ ] 40 è¬é–€æª»è­¦ç¤ºæ­£å¸¸é¡¯ç¤º
- [ ] åªæœ‰ Owner å¯å­˜å–

**æˆæœ¬è§£æå™¨ï¼š**
- [ ] 6 å€‹ç¯„ä¾‹å…¨éƒ¨æ­£ç¢ºè§£æ
- [ ] ä¸ç¢ºå®šå€¼æœ‰ âš ï¸ æ¨™è¨˜
- [ ] Dashboard æ•¸å­—æ›´æº–ç¢º

**çŸ¥è­˜åº«ï¼š**
- [x] Notion è³‡æ–™åº«çµæ§‹æ­£ç¢º
- [x] åŸºç¤è³‡æ–™å·²å¡«å…¥
- [ ] ç¶²ç«™å¯æŸ¥è©¢é¤å»³/é–€ç¥¨
- [ ] è¡Œç¨‹è¡¨å¯é€£å‹•é–€ç¥¨è³‡æ–™

---

## 6.6 å¾…ç¢ºèªäº‹é …

### éœ€è¦ Eric æä¾›

- [x] Notion API Integration Tokenï¼ˆç”¨æ–¼å»ºç«‹çŸ¥è­˜åº«ï¼‰
- [ ] ç¢ºèªç¾æœ‰ Notion æˆæœ¬æ¬„ä½çš„æ­£ç¢ºåç¨±
- [ ] å¥³å…’ç›®å‰å¹´ç´€ï¼ˆè¦åŠƒå‚³æ‰¿å…§å®¹åˆ†éšæ®µï¼‰

### è¨­è¨ˆæ±ºç­–

| å•é¡Œ | ç›®å‰æ±ºå®š | ç‹€æ…‹ |
|------|---------|------|
| æœˆå ±è¡¨ | å…ˆä¸åšï¼Œåªåšå€é–“çµ±è¨ˆ | âœ… å·²ç¢ºèª |
| åŒ¯ç‡è¿½è¹¤ | ç°¡åŒ–ç‰ˆï¼ˆå°å¹£â†’æ³°éŠ–ï¼‰ | âœ… å·²ç¢ºèª |
| æˆæœ¬è§£æ | è¦å‰‡å¼ + LLM æ··åˆ | âœ… å·²ç¢ºèª |
| çŸ¥è­˜åº«å»ºç«‹ | API è‡ªå‹•å»ºç«‹ | âœ… å·²å®Œæˆ |

---

## ç›¸é—œæ–‡ä»¶

- Phase 3 å…§éƒ¨å·¥å…·ï¼š`docs/plans/2026-01-22-phase3-internal-tools.md`
- Dashboard è¨­è¨ˆï¼š`docs/plans/2026-01-21-dashboard-and-pdf-itinerary-design.md`
- çµæ§‹åŒ–ç·¨è¼¯å™¨ï¼š`docs/plans/2026-01-22-structured-form-editor-design.md`

---

*æœ€å¾Œæ›´æ–°ï¼š2026-01-26*
